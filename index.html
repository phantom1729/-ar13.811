<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raksha - Connected Safety</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            background-color: #ffebee;
            margin: 0;
            padding: 20px;
            user-select: none;
        }

        h2 { 
            color: #b71c1c; 
            margin-bottom: 20px; 
        }

        /* ---------- BUTTON BASE ---------- */
        .btn {
            width: 100%;
            padding: 22px;
            margin: 18px 0;
            font-size: 18px;
            border: none;
            border-radius: 16px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.25);
            transition: all 0.25s ease;
        }

        .btn:active {
            transform: scale(0.96);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* ---------- GREEN BUTTON ---------- */
        .btn-green {
            background: linear-gradient(135deg, #2e7d32, #43a047);
        }

        /* ---------- BLUE BUTTON ---------- */
        .btn-blue {
            background: linear-gradient(135deg, #1565c0, #1e88e5);
        }

        /* ---------- SOS BUTTON ---------- */
        .btn-red { 
            background: linear-gradient(135deg, #c62828, #ff5252);
            height: 150px; 
            font-size: 28px;
            border: 3px solid rgba(255,255,255,0.4);
            text-shadow: 0 2px 4px rgba(0,0,0,0.4);
            animation: pulse 1.4s infinite;
        }

        @keyframes pulse {
            0% { 
                transform: scale(1); 
                box-shadow: 0 0 15px rgba(211,47,47,0.9); 
            }
            50% { 
                transform: scale(1.04); 
                box-shadow: 0 0 35px rgba(211,47,47,1); 
            }
            100% { 
                transform: scale(1); 
                box-shadow: 0 0 15px rgba(211,47,47,0.9); 
            }
        }

        #status { 
            font-weight: bold; 
            color: #333; 
            margin-top: 15px; 
            font-size: 14px; 
        }

        /* STEALTH MODE */
        #stealthOverlay { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: black; 
            z-index: 99999; 
        }
    </style>
</head>

<body>

    <h2>üõ°Ô∏è Raksha Safety App</h2>
    <p style="color:#666;font-size:13px;">Connected to Parent's Telegram</p>

    <button class="btn btn-green" onclick="manualLocation()">
        üìç Share Location (WhatsApp)
    </button>

    <a href="tel:+918409681110" style="text-decoration:none;">
        <button class="btn btn-blue">üìû Call Papa</button>
    </a>

    <hr style="opacity:0.3;margin:25px 0;">

    <button class="btn btn-red" onclick="startEmergency()">
        üÜò SOS ALERT
        <br>
        <span style="font-size:14px;font-weight:normal;">
            (Call 112 + Auto-Send Audio/Loc)
        </span>
    </button>

    <p id="status">System Ready</p>
    <div id="stealthOverlay" onclick="stopEmergency()"></div>

    <script>
        const BOT_TOKEN = "8378037937:AAGjuFdZWLnf0kFfTG_QIFCslgvrDMb-sC4";
        const CHAT_ID = "8508792403";

        let mediaRecorder;
        let audioChunks = [];
        let tapCount = 0;
        let locationInterval;
        let audioInterval;

        function startEmergency() {
            document.getElementById("status").innerText = "‚ö†Ô∏è SENDING ALERTS TO TELEGRAM...";
            document.getElementById("status").style.color = "red";

            window.location.href = "tel:112";

            sendLocationToTelegram();
            locationInterval = setInterval(sendLocationToTelegram, 30000);

            startAudioRecording();

            setTimeout(() => {
                document.getElementById("stealthOverlay").style.display = "block";
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
            }, 4000);
        }

        function sendLocationToTelegram() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lon = pos.coords.longitude;

                    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation?chat_id=${CHAT_ID}&latitude=${lat}&longitude=${lon}`);
                    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=üö® SOS ALERT! Location Updated.`);
                });
            }
        }

        async function startAudioRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = sendAudioToTelegram;

                mediaRecorder.start();

                audioInterval = setInterval(() => {
                    if (mediaRecorder.state === "recording") {
                        mediaRecorder.stop();
                        mediaRecorder.start();
                    }
                }, 15000);
            } catch {
                alert("Microphone Access Denied!");
            }
        }

        function sendAudioToTelegram() {
            if (!audioChunks.length) return;

            const blob = new Blob(audioChunks, { type: "audio/ogg" });
            audioChunks = [];

            const formData = new FormData();
            formData.append("chat_id", CHAT_ID);
            formData.append("voice", blob, "evidence.ogg");

            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVoice`, {
                method: "POST",
                body: formData
            });
        }

        function manualLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const link = `http://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
                    window.location.href = `https://wa.me/?text=${encodeURIComponent("I am sharing my location: " + link)}`;
                });
            }
        }

        function stopEmergency() {
            tapCount++;
            if (tapCount >= 3) {
                document.getElementById("stealthOverlay").style.display = "none";
                document.getElementById("status").innerText = "Safety Mode OFF";
                document.getElementById("status").style.color = "green";

                clearInterval(locationInterval);
                clearInterval(audioInterval);
                if (mediaRecorder) mediaRecorder.stop();

                tapCount = 0;
                if (document.exitFullscreen) document.exitFullscreen();

                alert("Emergency Mode Stopped.");
                location.reload();
            }
        }
    </script>

</body>
</html>
